{"version":3,"file":"main.js","sources":["../src/create-webgl-program.js","../src/main.js"],"sourcesContent":["function createWebglProgram(gl, shaderObjects) {\n  const shaders = []\n\n  for (var i = 0; i < shaderObjects.length; ++i) {\n    let { type, text } = shaderObjects[i]\n\n    if (type === 'x-shader/x-vertex') {\n      type = gl.VERTEX_SHADER\n    } else if (type === 'x-shader/x-fragment') {\n      type = gl.FRAGMENT_SHADER\n    }\n\n    const shader = gl.createShader(type)\n\n    gl.shaderSource(shader, text)\n    gl.compileShader(shader)\n    gl.getShaderParameter(shader, gl.COMPILE_STATUS)\n\n    shaders.push(shader)\n  }\n\n  const program = gl.createProgram()\n\n  shaders.forEach(shader => gl.attachShader(program, shader))\n\n  gl.linkProgram(program)\n\n  return program\n}\n\nexport default createWebglProgram\n","import createWebglProgram from './create-webgl-program'\n\nconst vertexShader = {\n  type: 'x-shader/x-vertex',\n  text: `\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec2 zeroToOne = a_position / u_resolution;\n  vec2 zeroToTwo = zeroToOne * 2.0;\n  vec2 clipSpace = zeroToTwo - 1.0;\n  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  v_texCoord = a_texCoord;\n}\n`\n}\n\nconst fragmentShader = {\n  type: 'x-shader/x-fragment',\n  text: `\nprecision mediump float;\n\nvarying lowp vec2 v_texCoord;\n\nuniform sampler2D u_image0;\nuniform sampler2D u_image1; // lookup texture\n\nvoid main()\n{\n  vec4 textureColor = texture2D(u_image0, v_texCoord);\n\n  float blueColor = textureColor.b * 63.0;\n\n  vec2 quad1;\n  quad1.y = floor(floor(blueColor) / 8.0);\n  quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n  vec2 quad2;\n  quad2.y = floor(ceil(blueColor) / 8.0);\n  quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n  vec2 texPos1;\n  texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n  texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n  vec2 texPos2;\n  texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n  texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n  lowp vec4 newColor1 = texture2D(u_image1, texPos1);\n  lowp vec4 newColor2 = texture2D(u_image1, texPos2);\n\n  lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n\n  gl_FragColor = mix(textureColor, vec4(newColor.rgb, textureColor.w), 1.0);\n}\n`\n}\n\nfunction lutFilter ({ canvas, filterImage, image }) {\n  const gl = canvas.getContext('webgl')\n  const program = createWebglProgram(gl, [vertexShader, fragmentShader])\n\n  const positionLocation = gl.getAttribLocation(program, 'a_position')\n  const texcoordLocation = gl.getAttribLocation(program, 'a_texCoord')\n\n  const positionBuffer = gl.createBuffer()\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)\n\n  const texcoordBuffer = gl.createBuffer()\n  gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer)\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n      0.0,  0.0,\n      1.0,  0.0,\n      0.0,  1.0,\n      0.0,  1.0,\n      1.0,  0.0,\n      1.0,  1.0,\n  ]), gl.STATIC_DRAW)\n\n  const resolutionLocation = gl.getUniformLocation(program, 'u_resolution')\n  const u_image0Location = gl.getUniformLocation(program, 'u_image0')\n  const u_image1Location = gl.getUniformLocation(program, 'u_image1')\n\n  canvas.width = image.width\n  canvas.height = image.height\n\n  const image_texture = gl.createTexture()\n  gl.bindTexture(gl.TEXTURE_2D, image_texture)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image)\n\n  const filterImage_texture = gl.createTexture()\n  gl.bindTexture(gl.TEXTURE_2D, filterImage_texture)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, filterImage)\n\n  gl.clearColor(0, 0, 0, 0)\n  gl.clear(gl.COLOR_BUFFER_BIT)\n  gl.useProgram(program)\n\n  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height)\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n     0, 0,\n     canvas.width, 0,\n     0, canvas.height,\n     0, canvas.height,\n     canvas.width, 0,\n     canvas.width, canvas.height,\n  ]), gl.STATIC_DRAW)\n  gl.enableVertexAttribArray(positionLocation)\n\n  gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0)\n\n  gl.enableVertexAttribArray(texcoordLocation)\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, texcoordBuffer)\n  gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0)\n\n  gl.uniform2f(resolutionLocation, gl.canvas.width, gl.canvas.height)\n\n  gl.uniform1i(u_image0Location, 0)\n  gl.uniform1i(u_image1Location, 1)\n\n  gl.activeTexture(gl.TEXTURE0)\n  gl.bindTexture(gl.TEXTURE_2D, image_texture)\n  gl.activeTexture(gl.TEXTURE1)\n  gl.bindTexture(gl.TEXTURE_2D, filterImage_texture)\n\n  gl.drawArrays(gl.TRIANGLES, 0, 6)\n}\n\nexport default lutFilter\n"],"names":[],"mappings":"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"}